# 全栈项目规划：垂直切片与 API 先行

## 核心理念：API 先行 + 垂直切片

### 1. 现代最佳实践：API 先行 (API-First)

**最好的方法是不要“先写代码”，而是“先做设计”。**

即使我们改变了开发流程，"API 先行" 依然是不可动摇的核心。**API 是连接前后端的“契约” (Contract)**。在对任何一个功能（Feature）动手写代码之前，必须先定义好这份契约。

这份“契约”定义了：

1. **数据模型:** 这个功能涉及哪些字段？
2. **API 路由:** `GET /api/v1/comments`
3. **交互格式:** Request/Response 的 JSON 结构。
4. **错误处理:** 异常情况返回什么状态码。

### 2. 开发模式转变：垂直切片 (Vertical Slices)

我们要摒弃“先做完所有后端，再做所有前端”的水平分层模式。 我们要采用 **“垂直切片”**：将一个大的应用切分成一个个细小的、独立的功能点（User Story）。

- **水平分层（旧模式）：** 画完所有 UI -> 写完所有 API -> 写完所有前端 -> 最后集成爆炸。
- **垂直切片（新模式）：** 挑选一个功能（如“点赞”） -> 设计它的 API -> 修改它的 DB -> 写它的后端 -> 写它的前端 -> 集成并交付。

------

## 敏捷全栈开发流程：迭代循环

我们将项目开发分为两个部分：**“第0阶段：地基搭建”** 和 **“核心阶段：迭代开发循环”**。

### 第0阶段：地基搭建 (Project Scaffolding)

*只做一次，搭建好能够支持“切片开发”的最小环境。*

1. **全栈初始化：** 同时初始化前端（Vite/React）和后端（Node/Go/Python）仓库。
2. **基础设施：**
   - 跑通“Hello World”接口：确保前端能请求到后端。
   - 配置好数据库连接。
   - 配置好基础的 CI/CD 或 Lint 工具。
3. **全局规划：** 确定技术栈，设计**最核心**的 1-2 个实体（如 User），但不要设计整个数据库，留给迭代去演进。

------

### 核心阶段：垂直切片开发循环 (The Development Loop)

*这是你每天的工作流。每一个循环只专注一个“用户故事” (User Story)。*

#### 步骤 1：切片定义与契约设计 (Pick & Plan)

- **挑选切片：** 从需求池中选一个高优先级的**小**功能。
  - *例如：“作为一个用户，我想修改我的头像。”*
- **微型设计：**
  - **DB 变更：** 需要给 User 表加 `avatar_url` 字段吗？
  - **API 契约：** 只有针对**这一个功能**，设计 API (`POST /user/avatar`)。使用 Swagger/OpenAPI 快速定义好 Input/Output。

#### 步骤 2：后端穿透 (Backend Slice)

- **实现层：** 根据刚才的契约，修改 Entity，编写 Service，实现 Controller。
- **单元测试：** 使用 Postman 或自动化测试，验证这个**单一接口**是否通畅。
  - *关键点：只写支持当前功能所需的代码，不要过度设计未来可能用到的功能。*

#### 步骤 3：前端穿透 (Frontend Slice)

- **UI 组件：** 开发上传头像的按钮和预览组件。
- **对接：** 不需要 Mock！因为刚才你已经把后端接口写好了。直接调用真实的 `POST /user/avatar`。
- **状态管理：** 处理上传中的 Loading 状态和成功后的图片更新。

#### 步骤 4：即时集成与验证 (Integrate & Verify)

- **联调：** 因为是刚写完的热乎代码，且遵循了契约，联调通常只需几分钟。
- **验收：** 在浏览器中真实操作一遍“修改头像”。
- **提交：** 既然这个功能已经前后端跑通，它可以被视为“可交付软件”。**Commit & Push!**

------

### 实战示例：开发“文章评论”功能

| 步骤        | 动作 (Action)                         | 产出 (Output)            |
| ----------- | ------------------------------------- | ------------------------ |
| **1. 设计** | 定义 `POST /api/posts/:id/comments`   | Swagger 文档更新         |
| **2. 后端** | 创建 `Comment` 表，写 API 逻辑        | 数据库迁移文件，后端 API |
| **3. 前端** | 写“评论输入框”组件，调用 API          | 前端 UI 组件             |
| **4. 验收** | 前端点击发送，数据库出现数据，UI 刷新 | **一个完整可用的功能**   |

------

## 部署与运维 (持续交付)

在垂直切片模式下，部署不再是“最后的大爆炸”，而是**日常习惯**。

1. **自动化部署：** 每当你完成一个切片并合并代码，CI/CD 流水线应该自动运行测试并更新 预发布/生产 环境。
2. **特性开关 (Feature Flags)：** 如果切片还没完全做完（比如只做了后端），可以使用特性开关隐藏前端入口，保持主分支永远可发布。

------

### 总结建议：敏捷全栈之道

对于个人开发者或小型团队，抛弃瀑布流，拥抱垂直切片：

1. **按“价值”开发，不按“层”开发：** 不要问“数据库建完了吗？”，要问“登录功能做完了吗？”。
2. **小步快跑：** 一个切片最好能在 **0.5 ~ 2 天** 内完成。如果一个功能需要做一周，把它拆细（例如：先做“纯文本评论”，下个循环再做“带图评论”）。
3. **契约护航：** 哪怕切片再小，也要先定 API 契约，这是不重构代码的保证。
4. **随时可发布：** 你的软件在任何时刻，都应该是一个功能不完整、但已完成部分完全可运行的系统。